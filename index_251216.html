<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boarding - Modern Finance App</title>
    <style>
        /* ====================================
           1. Wise Style Custom Properties
           ==================================== */
        :root {
            --primary-color: #5544FF; /* Main Purple/Blue */
            --secondary-color: #37C3FF; /* Light Blue/Cyan */
            --background-color: #F8F8F8;
            --card-background: #FFFFFF;
            --text-color: #1F2327;
            --sub-text-color: #79818B;
            --card-gradient: linear-gradient(135deg, #FF6B6B, #FFD93D, #5544FF);
            --tab-color-active: #5544FF;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
        }

        /* ====================================
           2. App Shell & Structure
           ==================================== */
        .app-shell {
            max-width: 450px; /* ìŠ¤ë§ˆíŠ¸í° í¬ê¸° */
            margin: 0 auto;
            background-color: var(--card-background);
            min-height: 100vh;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
            position: relative;
            padding-bottom: 70px; /* í•˜ë‹¨ íƒ­ ë°” ê³µê°„ í™•ë³´ */
        }

        .page { display: none; padding: 20px; }
        .page.active { display: block; }
        
        /* ====================================
           3. Top Bar & Header (Minimal)
           ==================================== */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
            padding: 20px 20px 0;
        }
        .topbar .profile {
            width: 30px; height: 30px; border-radius: 50%; background-color: #FFC0CB; margin-right: 15px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#6c5ce7"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 80%;
        }
        .topbar .pill {
            background: #EAE3FF;
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
        }

        /* ====================================
           4. Card & Balance Area (Home)
           ==================================== */
        .card-container {
            padding: 0 20px;
        }
        .gradient-card {
            width: 100%;
            height: 180px;
            background: var(--card-gradient);
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(85, 68, 255, 0.3);
            padding: 15px;
            color: white;
            position: relative;
            margin-bottom: 25px;
        }
        .gradient-card .label { font-size: 12px; font-weight: 600; opacity: 0.8; }
        .gradient-card .number { margin-top: 50px; font-size: 16px; font-weight: 500; }

        .balance-area {
            text-align: center;
            margin-bottom: 30px;
        }
        .balance-area .currency { font-size: 18px; font-weight: 500; color: var(--sub-text-color); margin-bottom: 5px; }
        .balance-area .amount { font-size: 40px; font-weight: 900; color: var(--text-color); }

        /* ====================================
           5. Quick Actions
           ==================================== */
        .action-tray {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
        }
        .action-btn-pill {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--primary-color);
            cursor: pointer;
            gap: 5px;
        }
        .action-btn-pill .icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #EAE3FF;
            color: var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }

        /* í€µ ì•¡ì…˜ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .quick-actions-grid {
            padding: 0 20px;
        }
        .quick-actions-grid h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 15px;
        }
        .grid-4 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .action-card {
            background-color: var(--card-background);
            border-radius: 15px;
            padding: 15px;
            color: white;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        .action-card .icon { font-size: 20px; }
        .action-card.purple { background-color: #9C27B0; }
        .action-card.blue { background-color: #3F51B5; }
        .action-card.green { background-color: #4CAF50; }
        .action-card.orange { background-color: #FF9800; }


        /* ====================================
           6. Bottom Navigation Bar (Tab Bar)
           ==================================== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 450px;
            margin: 0 auto;
            height: 70px;
            background: var(--card-background);
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            font-weight: 600;
            color: var(--sub-text-color);
            cursor: pointer;
            transition: color 0.2s;
        }
        .nav-item i {
            font-size: 20px;
            margin-bottom: 3px;
        }
        .nav-item.active {
            color: var(--tab-color-active);
        }
        
        /* ====================================
           7. Other Pages (Form Styles)
           ==================================== */
        .form-card {
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        .charge-amount-confirm {
            background: #f1f5ff;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        /* ê¸°ì¡´ ì¶©ì „ UI ìŠ¤íƒ€ì¼ (Minimal) */
        .dual-currency { /* ìœ ì§€ */
            display: flex; align-items: center; gap: 12px; padding: 12px;
            border-radius: 12px; background: #f7f9ff; margin-top: 10px;
        }
        .currency-box { flex: 1; padding: 8px; border-radius: 10px; }
        .currency-box input {
            width: 100%; border: none; background: transparent; font-size: 20px; /* í°íŠ¸ ì‘ê²Œ */
            font-weight: 800; outline: none;
        }
        .currency-choice-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;
        }
        .currency-choice {
            padding: 10px; border: 1px solid #e5e7eb; border-radius: 10px; cursor: pointer;
            font-weight: 700; text-align: center; transition: all 0.2s; background: #fff;
            display: flex; flex-direction: column; align-items: center; gap: 3px;
            font-size: 12px; color: var(--text-color);
        }
        .currency-choice.active { border-color: var(--primary-color); box-shadow: 0 2px 8px rgba(45,108,255,0.12); }
        .currency-flag {
            width: 24px; height: 24px; border-radius: 50%; font-size: 18px; line-height: 24px;
            text-align: center; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        
        /* ì´ì „ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (2ë‹¨ê³„) */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 700;
            color: var(--primary-color);
            cursor: pointer;
            margin-bottom: 12px;
            text-decoration: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<div class="app-shell">
    <div class="topbar">
        <div class="profile"></div>
        <div class="pill" onclick="showToast('ì•Œë¦¼ í˜ì´ì§€ë¡œ ì´ë™')"><i class="fas fa-bell"></i></div>
    </div>

    <section class="page active" id="page-home">
        
        <div class="card-container">
            <div class="gradient-card">
                <div class="label">Boarding VIRTUAL</div>
                <div style="font-size:10px; margin-top:5px;">0023 B Card</div>
                <div style="position: absolute; right: 15px; top: 15px; font-weight:700;">ğŸ’³</div>
                <div style="position: absolute; right: 15px; bottom: 15px; font-weight:700;">MasterCard</div>
            </div>
        </div>

        <div class="balance-area">
            <div class="currency">ì´ ì”ì•¡ (USD í™˜ì‚°)</div>
            <div class="amount" id="total-assets">$3,860.00</div>
        </div>

        <div class="action-tray">
            <div class="action-btn-pill" data-target="page-transfer">
                <div class="icon"><i class="fas fa-share"></i></div>
                ì†¡ê¸ˆ
            </div>
            <div class="action-btn-pill" data-target="page-charge">
                <div class="icon"><i class="fas fa-plus"></i></div>
                ì¶©ì „
            </div>
            <div class="action-btn-pill" onclick="showToast('ìš”ì²­ ê¸°ëŠ¥ ì¤€ë¹„ì¤‘')">
                <div class="icon"><i class="fas fa-arrow-down"></i></div>
                ìš”ì²­
            </div>
            <div class="action-btn-pill" data-target="page-remit">
                <div class="icon"><i class="fas fa-exchange-alt"></i></div>
                í™˜ì „
            </div>
        </div>

        <div class="quick-actions-grid">
            <h3>í€µ ì•¡ì…˜</h3>
            <div class="grid-4">
                <div class="action-card purple" onclick="showToast('ì†Œë¹„ ë‚´ì—­ìœ¼ë¡œ ì´ë™')">
                    <div class="label">Quick actions</div>
                    <div><i class="fas fa-shopping-bag"></i> Groceries</div>
                </div>
                <div class="action-card blue" onclick="showToast('êµí†µì¹´ë“œ ì¶©ì „ìœ¼ë¡œ ì´ë™')">
                    <div class="label">Quick actions</div>
                    <div><i class="fas fa-bus"></i> Transport</div>
                </div>
                <div class="action-card green" onclick="showToast('ë¯¸ì…˜/í˜œíƒìœ¼ë¡œ ì´ë™')">
                    <div class="label">ë¯¸ì…˜</div>
                    <div><i class="fas fa-trophy"></i> 5,000 P</div>
                </div>
                <div class="action-card orange" onclick="showToast('ì²´ë¥˜ ì§€ì›ìœ¼ë¡œ ì´ë™')">
                    <div class="label">ì²´ë¥˜ ì§€ì›</div>
                    <div><i class="fas fa-flag"></i> D-88</div>
                </div>
            </div>
        </div>
        
    </section>

    <section class="page" id="page-charge">
        <a class="back-link" data-target="page-home"><i class="fas fa-arrow-left"></i> í™ˆìœ¼ë¡œ</a>
        <div class="form-card">
            <h2 style="margin-top:0;">ì„ ë¶ˆê³„ì¢Œ ì¶©ì „</h2>
            <p style="color:var(--sub-text-color); margin-top:4px;">ì¹´ë“œ ì”ì•¡ì´ ì´ ìì‚°ì— ë°˜ì˜ë©ë‹ˆë‹¤.</p>

            <div class="charge-step active" id="charge-step-amount">
                <div class="currency-choice-grid" id="currency-choice-grid">
                    <div class="currency-choice active" data-currency="USD">
                        <span class="currency-flag">ğŸ‡ºğŸ‡¸</span>
                        USD
                    </div>
                    <div class="currency-choice" data-currency="EUR">
                        <span class="currency-flag">ğŸ‡ªğŸ‡º</span>
                        EUR
                    </div>
                    <div class="currency-choice" data-currency="AUD">
                        <span class="currency-flag">ğŸ‡¦ğŸ‡º</span>
                        AUD
                    </div>
                </div>

                <div class="dual-currency" id="dual-currency">
                    <div class="currency-box selectable active" data-currency="krw">
                        <small style="color:var(--sub-text-color)">KRW</small>
                        <input id="charge-krw-input" type="text" inputmode="decimal" placeholder="0">
                    </div>
                    
                    <div class="swap-arrow"><i class="fas fa-exchange-alt"></i></div> 
                    
                    <div class="currency-box selectable" data-currency="local">
                        <small style="color:var(--sub-text-color)" id="local-currency-label">USD</small>
                        <input id="charge-local-input" type="text" inputmode="decimal" placeholder="0">
                    </div>
                </div>
                
                <button class="btn primary" id="charge-next" style="margin-top:14px; width:100%;">ë‹¤ìŒ</button>
            </div>

            <div class="charge-step" id="charge-step-method">
                <a class="back-link" id="charge-back-to-amount" style="margin-bottom: 20px;"><i class="fas fa-arrow-left"></i> ê¸ˆì•¡ ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                
                <div class="charge-amount-confirm" id="charge-amount-confirm"></div>

                <p style="font-weight:700; margin:0 0 8px;">ì–´ë””ì„œ ì¶©ì „í• ê¹Œìš”?</p>
                <div class="choice-grid">
                    <div class="choice" data-method="cash"><i class="fas fa-store"></i> í¸ì˜ì  KRW í˜„ê¸ˆ ì¶©ì „</div>
                    <div class="choice" data-method="card"><i class="fas fa-credit-card"></i> Credit Card/Debit Card ì¶©ì „</div>
                </div>

                <div class="barcode-box" id="barcode-box" style="display:none;">
                    <div style="font-weight:700; margin-bottom:6px;">ì¶©ì „ìš© ë°”ì½”ë“œ</div>
                    <img id="barcode-img" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='260' height='80'><rect width='260' height='80' fill='white'/><g stroke='black' stroke-width='6'><line x1='15' y1='10' x2='15' y2='70'/><line x1='35' y1='10' x2='35' y2='70'/><line x1='55' y1='10' x2='55' y2='70'/><line x1='80' y1='10' x2='80' y2='70'/><line x1='100' y1='10' x2='100' y2='70'/><line x1='120' y1='10' x2='120' y2='70'/><line x1='145' y1='10' x2='145' y2='70'/><line x1='165' y1='10' x2='165' y2='70'/><line x1='185' y1='10' x2='185' y2='70'/><line x1='205' y1='10' x2='205' y2='70'/><line x1='225' y1='10' x2='225' y2='70'/></g><text x='130' y='60' text-anchor='middle' font-family='monospace' font-size='14'>CHARGE</text></svg>" alt="barcode" style="width:220px; height:auto;">
                    <div style="margin-top:6px; color:var(--sub-text-color); font-size:12px;">í¸ì˜ì ì—ì„œ ìŠ¤ìº” í›„ ê²°ì œí•˜ì„¸ìš”.</div>
                    <button class="btn primary" id="barcode-complete" style="margin-top:10px; width:100%;">ì¶©ì „ ì™„ë£Œ ì²˜ë¦¬</button>
                </div>

                <div class="card-form" id="card-form" style="display:none;">
                    <div class="input-group">
                        <label for="card-number">ì¹´ë“œ ë²ˆí˜¸</label>
                        <input type="text" id="card-number" placeholder="0000 0000 0000 0000" inputmode="numeric" maxlength="19">
                    </div>
                    <div class="input-group">
                        <label for="card-exp">ìœ íš¨ê¸°ê°„ (MM/YY)</label>
                        <input type="text" id="card-exp" placeholder="12/27" maxlength="5">
                    </div>
                    <div class="input-group">
                        <label for="card-cvc">CVC</label>
                        <input type="password" id="card-cvc" placeholder="***" maxlength="4" inputmode="numeric">
                    </div>
                    <button class="btn primary" id="card-submit"><i class="fas fa-wallet"></i> ì¹´ë“œë¡œ ì¶©ì „í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </section>

    <section class="page" id="page-transfer">
        <a class="back-link" data-target="page-home"><i class="fas fa-arrow-left"></i> í™ˆìœ¼ë¡œ</a>
        <div class="form-card">
            <h2 style="margin-top:0;">ì†¡ê¸ˆ (ì—°ê²°ê³„ì¢Œ)</h2>
            <p style="color:var(--sub-text-color); margin-top:4px;">ì„ ë¶ˆê³„ì¢Œì—ì„œ ì—°ê²°ëœ êµ­ë‚´ ê³„ì¢Œë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
            <div class="input-group">
                <label for="transfer-amount">ì´ì²´ ê¸ˆì•¡ (â‚©)</label>
                <input type="number" id="transfer-amount" min="0" inputmode="numeric" placeholder="ì˜ˆ: 30000">
            </div>
            <button class="btn primary" id="transfer-submit"><i class="fas fa-exchange-alt"></i> ì†¡ê¸ˆí•˜ê¸°</button>
        </div>
    </section>

    <section class="page" id="page-remit">
        <a class="back-link" data-target="page-home"><i class="fas fa-arrow-left"></i> í™ˆìœ¼ë¡œ</a>
        <div class="form-card">
            <h2 style="margin-top:0;">í™˜ì „ ë° í•´ì™¸ ì†¡ê¸ˆ</h2>
            <p style="color:var(--sub-text-color); margin-top:4px;">ì”ì•¡/ì´ìì‚°ì´ ê°ì†Œí•˜ë©°, ìˆ˜ìˆ˜ë£Œê°€ í¬í•¨ë©ë‹ˆë‹¤.</p>
            <div class="input-group">
                <label for="remit-amount">ì†¡ê¸ˆ/í™˜ì „ ê¸ˆì•¡ (â‚©)</label>
                <input type="number" id="remit-amount" min="0" inputmode="numeric" placeholder="ì˜ˆ: 100000">
            </div>
            <div class="input-group">
                <label for="remit-currency">í†µí™” ì„ íƒ</label>
                <select id="remit-currency">
                    <option value="USD">USD (ìˆ˜ìˆ˜ë£Œ 5,000ì›)</option>
                    <option value="EUR">EUR (ìˆ˜ìˆ˜ë£Œ 4,000ì›)</option>
                    <option value="JPY">JPY (ìˆ˜ìˆ˜ë£Œ 3,000ì›)</option>
                </select>
            </div>
            <button class="btn primary" id="remit-submit"><i class="fas fa-plane-departure"></i> ì†¡ê¸ˆí•˜ê¸°</button>
        </div>
    </section>
</div>

<div class="bottom-nav">
    <div class="nav-item active" data-target="page-home"><i class="fas fa-home"></i> Home</div>
    <div class="nav-item" onclick="showToast('ê²°ì œ ë‚´ì—­')"><i class="fas fa-money-check-alt"></i> Payments</div>
    <div class="nav-item" onclick="showToast('ì¹´ë“œ ê´€ë¦¬')"><i class="fas fa-credit-card"></i> Cards</div>
    <div class="nav-item" onclick="showToast('í”„ë¡œí•„')"><i class="fas fa-user-circle"></i> Profile</div>
</div>

<div class="toast" id="toast"></div>

<script>
    const state = {
        totalAssets: 1540000,
        cardBalance: 840000,
        points: 12000,
        missionAvailable: true,
        visaDday: 88,
        timeline: [
            { icon: 'fa-wallet', title: 'ì„ ë¶ˆê³„ì¢Œ ì¶©ì „', desc: 'ê°„í¸ ì¶©ì „ ì„±ê³µ', amount: '+â‚©200,000' },
            { icon: 'fa-plane', title: 'í•­ê³µê¶Œ ê²°ì œ', desc: 'Korea â†’ USA', amount: '-â‚©650,000' },
            { icon: 'fa-coins', title: 'í™˜ì „ ëª©í‘œ ë“±ë¡', desc: 'ë‹¬ëŸ¬ ëª©í‘œí™˜ìœ¨ 1,320ì›', amount: 'ì•Œë¦¼ ON' },
        ],
    };

    const exchangeRates = {
        USD: 1300,
        EUR: 1400,
        AUD: 850,
    };

    const el = {
        totalAssets: document.getElementById('total-assets'),
        // Note: element references updated to reflect new UI where available
        toast: document.getElementById('toast'),
        transferInput: document.getElementById('transfer-amount'),
        remitInput: document.getElementById('remit-amount'),
        remitCurrency: document.getElementById('remit-currency'),
        
        // ì¶©ì „ ê´€ë ¨ ìš”ì†Œ
        chargeKrwInput: document.getElementById('charge-krw-input'),
        chargeLocalInput: document.getElementById('charge-local-input'),
        localCurrencyLabel: document.getElementById('local-currency-label'),
        currencyBoxes: document.querySelectorAll('.dual-currency .currency-box.selectable'),
        currencyChoiceBtns: document.querySelectorAll('.currency-choice-grid .currency-choice'), 
        chargeAmountConfirm: document.getElementById('charge-amount-confirm'), 
        
        chargeSteps: {
            amount: document.getElementById('charge-step-amount'),
            method: document.getElementById('charge-step-method'),
        },
        barcodeBox: document.getElementById('barcode-box'),
        cardForm: document.getElementById('card-form'),
        barcodeComplete: document.getElementById('barcode-complete'),
        cardSubmit: document.getElementById('card-submit'),
        choiceBtns: document.querySelectorAll('.choice'),
        chargeNext: document.getElementById('charge-next'),
        chargeBackToAmount: document.getElementById('charge-back-to-amount'),
        cardNumber: document.getElementById('card-number'),
        cardExp: document.getElementById('card-exp'),
        cardCvc: document.getElementById('card-cvc'),
    };

    const pages = {
        'page-home': document.getElementById('page-home'),
        'page-charge': document.getElementById('page-charge'),
        'page-transfer': document.getElementById('page-transfer'),
        'page-remit': document.getElementById('page-remit'),
    };

    function formatMoney(value) {
        return `â‚©${value.toLocaleString('ko-KR')}`;
    }

    function pushTimeline(icon, title, desc, amount) {
        state.timeline = [{ icon, title, desc, amount }, ...state.timeline].slice(0, 6);
    }

    function render() {
        // Wise style: totalAssets is shown in USD equivalent on home screen
        const usdEquivalent = (state.totalAssets / exchangeRates['USD']).toFixed(2);
        el.totalAssets.textContent = `$${usdEquivalent}`;
    }

    function showToast(message) {
        el.toast.textContent = message;
        el.toast.style.opacity = 1;
        el.toast.style.display = 'block';
        setTimeout(() => {
            el.toast.style.opacity = 0;
            setTimeout(() => { el.toast.style.display = 'none'; }, 300);
        }, 1800);
    }

    function navigate(targetId) {
        Object.values(pages).forEach(p => p.classList.remove('active'));
        pages[targetId].classList.add('active');
        
        // Bottom nav activation
        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        const activeNav = document.querySelector(`.nav-item[data-target="${targetId}"]`);
        if (activeNav) activeNav.classList.add('active');
        else if (targetId === 'page-home') document.querySelector('.nav-item[data-target="page-home"]').classList.add('active');

        if (targetId === 'page-charge') {
            setChargeStep('amount');
            updateChargeDisplay();
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function submitTransfer() {
        const value = Number(el.transferInput.value);
        if (!value || value <= 0) {
            showToast('ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }
        if (value > state.cardBalance) {
            showToast(`ì”ì•¡(${formatMoney(state.cardBalance)})ì´ ë¶€ì¡±í•©ë‹ˆë‹¤`);
            return;
        }
        state.cardBalance -= value;
        state.totalAssets -= value; // ì´ìì‚°ë„ ê°ì†Œ (ì¹´ë“œ ì”ì•¡ì´ ì´ìì‚°ì˜ ì¼ë¶€ì´ë¯€ë¡œ)
        pushTimeline('fa-exchange-alt', 'ì†¡ê¸ˆ ì„±ê³µ', 'ì—°ê²°ê³„ì¢Œë¡œ ì†¡ê¸ˆ ì²˜ë¦¬ë¨', `-${formatMoney(value)}`);
        render();
        showToast('ì†¡ê¸ˆ ì™„ë£Œ');
        el.transferInput.value = '';
        navigate('page-home');
    }

    function submitRemit() {
        const value = Number(el.remitInput.value);
        if (!value || value <= 0) {
            showToast('ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }
        const fee = { USD: 5000, EUR: 4000, JPY: 3000 }[el.remitCurrency.value] || 5000;
        const total = value + fee;
        if (total > state.cardBalance) {
            showToast(`ì”ì•¡(${formatMoney(state.cardBalance)})ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (ìˆ˜ìˆ˜ë£Œ ${formatMoney(fee)} í¬í•¨)`);
            return;
        }
        state.cardBalance -= total;
        state.totalAssets -= total;
        const desc = `${el.remitCurrency.value} ì†¡ê¸ˆ (ìˆ˜ìˆ˜ë£Œ ${formatMoney(fee)})`;
        pushTimeline('fa-plane-departure', 'í•´ì™¸ ì†¡ê¸ˆ', desc, `-${formatMoney(total)}`);
        render();
        showToast('í•´ì™¸ ì†¡ê¸ˆ ì‹ ì²­ ì™„ë£Œ');
        el.remitInput.value = '';
        navigate('page-home');
    }

    function resetData() {
        // ê¸°ëŠ¥ì€ ë‚¨ê²¨ë‘ì§€ë§Œ, ìƒˆ UIì—ì„œëŠ” ë²„íŠ¼ì´ ì—†ìŒ.
        state.totalAssets = 1540000;
        state.cardBalance = 840000;
        state.points = 12000;
        state.missionAvailable = true;
        state.visaDday = 88;
        render();
        showToast('ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
        navigate('page-home');
    }

    // ì¶©ì „ ë‹¨ê³„ ê´€ë¦¬
    const chargeState = {
        step: 'amount',
        krw: 0,
        local: 0,
        currency: 'USD', 
        rate: exchangeRates['USD'],
        method: null,
        updating: false,
    };

    function getChargeAmountKrw() {
        return Math.round(chargeState.krw || 0);
    }

    function setActiveCurrency(target) {
        chargeState.active = target;
        el.currencyBoxes.forEach(box => {
            const targetData = (target === 'krw' ? 'krw' : 'local');
            box.classList.toggle('active', box.dataset.currency === targetData);
        });
        if (target === 'krw') el.chargeKrwInput.focus();
        if (target === 'local') el.chargeLocalInput.focus();
    }

    function updateChargeDisplay() {
        const krwRounded = chargeState.krw ? Math.round(chargeState.krw) : 0;
        el.chargeKrwInput.value = krwRounded || '';
        el.chargeLocalInput.value = chargeState.local > 0 ? chargeState.local.toFixed(2) : '';
    }
    
    function updateLocalCurrency(currencyCode) {
        if (chargeState.currency === currencyCode) return;

        chargeState.currency = currencyCode;
        chargeState.rate = exchangeRates[currencyCode];
        
        el.localCurrencyLabel.textContent = currencyCode;
        
        el.currencyChoiceBtns.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.currency === currencyCode);
        });

        chargeState.local = chargeState.krw / chargeState.rate;
        
        updateChargeDisplay();
    }

    function gotoMethodStep() {
        const amount = getChargeAmountKrw();
        
        // **ê¸ˆì•¡ ì œí•œ ì¡°ê±´**
        const MIN_CHARGE = 10000;
        const MAX_CHARGE = 200000;

        if (!amount || amount <= 0) {
            showToast('ì¶©ì „í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
            return;
        }
        
        if (amount < MIN_CHARGE) {
            showToast(`ìµœì†Œ ì¶©ì „ ê¸ˆì•¡ì€ ${formatMoney(MIN_CHARGE)}ì…ë‹ˆë‹¤.`);
            return;
        }

        if (amount > MAX_CHARGE) {
            showToast(`1íšŒ ìµœëŒ€ ì¶©ì „ ê¸ˆì•¡ì€ ${formatMoney(MAX_CHARGE)}ì…ë‹ˆë‹¤.`);
            return;
        }
        // **ê¸ˆì•¡ ì œí•œ ì¡°ê±´ ë**

        chargeState.krw = amount;
        chargeState.local = amount / chargeState.rate; 
        updateChargeDisplay();
        setChargeStep('method');
    }

    function setChargeStep(step) {
        chargeState.step = step;
        Object.values(el.chargeSteps).forEach(s => s.classList.remove('active'));
        el.chargeSteps[step].classList.add('active');
        
        if (step === 'amount') {
            // **[ìˆ˜ì •ëœ ë¶€ë¶„: 1ë‹¨ê³„ë¡œ ëŒì•„ê°ˆ ë•Œ ëª¨ë“  ìƒíƒœ ì´ˆê¸°í™”]**
            chargeState.method = null;
            el.barcodeBox.style.display = 'none';
            el.cardForm.style.display = 'none';
            el.choiceBtns.forEach(btn => btn.classList.remove('active'));
            // Note: ê¸ˆì•¡ í•„ë“œëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ ìƒíƒœë¡œ ìœ ì§€í•˜ì—¬ ì¬ì…ë ¥ í•„ìš” ì—†ê²Œ í•¨
            setActiveCurrency(chargeState.active || 'krw'); // ê¸°ì¡´ í™œì„± í†µí™” ìœ ì§€
            updateChargeDisplay();

        } else if (step === 'method') {
            // 2ë‹¨ê³„ ì§„ì… ì‹œ í™•ì • ê¸ˆì•¡ í‘œì‹œ
            const krwAmount = getChargeAmountKrw();
            el.chargeAmountConfirm.textContent = `${formatMoney(krwAmount)} KRWë¥¼ ì¶©ì „í•©ë‹ˆë‹¤. (ì•½ ${chargeState.local.toFixed(2)} ${chargeState.currency})`;
        }
    }

    function handleKrwInput() {
        if (chargeState.updating) return;
        const value = parseFloat(el.chargeKrwInput.value.replace(/,/g, '')) || 0;
        chargeState.updating = true;
        chargeState.krw = Math.max(0, value);
        chargeState.local = chargeState.krw / chargeState.rate;
        el.chargeLocalInput.value = chargeState.local > 0 ? chargeState.local.toFixed(2) : (value === 0 ? '' : '0.00');
        chargeState.updating = false;
    }

    function handleLocalInput() {
        if (chargeState.updating) return;
        const value = parseFloat(el.chargeLocalInput.value.replace(/,/g, '')) || 0;
        chargeState.updating = true;
        chargeState.local = Math.max(0, value);
        chargeState.krw = chargeState.local * chargeState.rate;
        el.chargeKrwInput.value = chargeState.krw > 0 ? Math.round(chargeState.krw) : (value === 0 ? '' : '0');
        chargeState.updating = false;
    }

    function selectMethod(method) {
        chargeState.method = method;
        el.choiceBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.method === method));
        if (method === 'cash') {
            el.barcodeBox.style.display = 'block';
            el.cardForm.style.display = 'none';
        } else if (method === 'card') {
            el.barcodeBox.style.display = 'none';
            el.cardForm.style.display = 'grid';
        }
    }

    function completeCharge(source) {
        const amount = getChargeAmountKrw();
        if (!amount) {
            showToast('ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
            return;
        }
        if (source === 'card' && (!el.cardNumber.value || !el.cardExp.value || !el.cardCvc.value)) {
            showToast('ì¹´ë“œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }
        
        state.cardBalance += amount;
        state.totalAssets += amount;
        
        const icon = source === 'cash' ? 'fa-store' : 'fa-credit-card';
        const title = source === 'cash' ? 'í¸ì˜ì  í˜„ê¸ˆ ì¶©ì „' : 'ì¹´ë“œ ì¶©ì „';
        const desc = source === 'cash' ? 'ë°”ì½”ë“œ ê²°ì œ ì™„ë£Œ' : 'ì¹´ë“œ ìŠ¹ì¸ ì™„ë£Œ';

        pushTimeline(icon, title, desc, `+${formatMoney(amount)}`);
        render();
        showToast('ì¶©ì „ ì™„ë£Œ');
        
        chargeState.krw = 0;
        chargeState.local = 0;
        if (source === 'card') {
            el.cardNumber.value = '';
            el.cardExp.value = '';
            el.cardCvc.value = '';
        }
        updateChargeDisplay();
        setChargeStep('amount');
        navigate('page-home');
    }


    // ë„¤ë¹„ê²Œì´ì…˜ ë° ì´ë²¤íŠ¸ ì—°ê²°
    document.querySelectorAll('[data-target]').forEach(btn => {
        btn.addEventListener('click', () => navigate(btn.dataset.target));
    });
    document.querySelectorAll('.nav-item').forEach(btn => {
        if (btn.dataset.target) {
             btn.addEventListener('click', () => navigate(btn.dataset.target));
        }
    });

    // ê¸°ì¡´ ê¸°ëŠ¥ ì—°ê²° 
    // (claimMission, resetDataëŠ” ìƒˆë¡œìš´ UIì—ì„œ ë²„íŠ¼ì´ ì—†ìœ¼ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬í•˜ê±°ë‚˜ ë¬´ì‹œë¨)
    // el.missionBanner.addEventListener('click', claimMission);
    // el.resetBtn.addEventListener('click', resetData);

    document.getElementById('transfer-submit').addEventListener('click', submitTransfer);
    document.getElementById('remit-submit').addEventListener('click', submitRemit);
    
    el.chargeNext.addEventListener('click', gotoMethodStep);
    
    el.chargeBackToAmount.addEventListener('click', () => setChargeStep('amount'));

    el.choiceBtns.forEach(btn => btn.addEventListener('click', () => selectMethod(btn.dataset.method)));
    
    // ì¶©ì „ ì™„ë£Œ í•¸ë“¤ëŸ¬ í†µí•©
    el.barcodeComplete.addEventListener('click', () => completeCharge('cash'));
    el.cardSubmit.addEventListener('click', () => completeCharge('card'));

    el.currencyChoiceBtns.forEach(btn => {
        btn.addEventListener('click', () => updateLocalCurrency(btn.dataset.currency));
    });

    el.chargeKrwInput.addEventListener('input', handleKrwInput);
    el.chargeLocalInput.addEventListener('input', handleLocalInput);
    document.querySelectorAll('.action-btn-pill[data-target]').forEach(btn => {
        btn.addEventListener('click', () => navigate(btn.dataset.target));
    });


    // ì´ˆê¸° ì‹¤í–‰
    render();
    updateChargeDisplay();
    updateLocalCurrency('USD');
    setActiveCurrency('krw');
</script>

</body>
</html>